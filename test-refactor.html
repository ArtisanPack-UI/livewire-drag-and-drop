<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Refactored Drag and Drop</title>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script type="module">
        import LivewireDragAndDrop from './src/index.js';
        
        // Register the plugin with Alpine
        document.addEventListener('alpine:init', () => {
            Alpine.plugin(LivewireDragAndDrop);
        });
    </script>
    <style>
        .drag-item {
            padding: 1rem;
            margin: 0.5rem;
            background: #f3f4f6;
            border: 2px solid #d1d5db;
            border-radius: 0.5rem;
            cursor: grab;
        }
        .drag-item:focus {
            outline: 2px solid #3b82f6;
        }
        .drag-item.is-dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        .drag-context {
            min-height: 200px;
            padding: 1rem;
            border: 2px dashed #9ca3af;
            border-radius: 0.5rem;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <div class="container" style="max-width: 600px; margin: 2rem auto; padding: 0 1rem;">
        <h1>Test Refactored Drag and Drop</h1>
        <p>This test verifies that the refactored code works correctly.</p>
        
        <div 
            x-data="{ items: ['Item 1', 'Item 2', 'Item 3'] }"
            x-drag-context="'test-group'"
            class="drag-context"
            @drag:end="console.log('Drag end event:', $event.detail)"
        >
            <template x-for="(item, index) in items" :key="index">
                <div 
                    x-drag-item="{ id: index, name: item }"
                    class="drag-item"
                    x-text="item"
                    tabindex="0"
                ></div>
            </template>
        </div>
        
        <div style="margin-top: 2rem;">
            <h2>Test Results</h2>
            <div id="test-results">
                <p>Testing refactored functionality...</p>
            </div>
        </div>
    </div>
    
    <script>
        // Simple test to verify functionality
        document.addEventListener('alpine:initialized', () => {
            const results = document.getElementById('test-results');
            
            setTimeout(() => {
                // Check if drag context is properly initialized
                const dragContext = document.querySelector('[x-drag-context]');
                const dragItems = document.querySelectorAll('[x-drag-item]');
                
                let tests = [];
                
                // Test 1: Drag context exists and has required properties
                if (dragContext && dragContext._dragContext && dragContext._finalizeDrop) {
                    tests.push('✅ Drag context properly initialized with finalizeDrop function');
                } else {
                    tests.push('❌ Drag context initialization failed');
                }
                
                // Test 2: Drag items exist and are accessible
                if (dragItems.length === 3) {
                    tests.push('✅ All drag items found and accessible');
                } else {
                    tests.push('❌ Drag items not found or incorrect count');
                }
                
                // Test 3: finalizeDrop function is callable
                try {
                    const mockElement = dragItems[0];
                    if (typeof dragContext._finalizeDrop === 'function') {
                        tests.push('✅ finalizeDrop function is accessible and callable');
                    } else {
                        tests.push('❌ finalizeDrop function not accessible');
                    }
                } catch (error) {
                    tests.push('❌ Error accessing finalizeDrop function: ' + error.message);
                }
                
                results.innerHTML = tests.map(test => `<p>${test}</p>`).join('');
            }, 1000);
        });
    </script>
</body>
</html>
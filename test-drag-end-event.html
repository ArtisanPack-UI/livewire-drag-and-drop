<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Drag:End Event</title>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script type="module">
        import LivewireDragAndDrop from './src/index.js';
        
        document.addEventListener('alpine:init', () => {
            LivewireDragAndDrop(Alpine);
        });
    </script>
    <style>
        .drag-container {
            border: 2px dashed #ccc;
            padding: 20px;
            margin: 20px;
            min-height: 200px;
        }
        
        .drag-item {
            background: #f0f0f0;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 5px 0;
            cursor: grab;
            border-radius: 4px;
        }
        
        .drag-item.is-grabbing {
            background: #e0f0ff;
            border-color: #007cba;
            transform: scale(1.02);
        }
        
        .event-log {
            margin: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .event-entry {
            margin-bottom: 10px;
            padding: 5px;
            background: white;
            border-radius: 3px;
        }
        
        .event-missing {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Test Drag:End Event Implementation</h1>
    
    <div class="event-log" id="eventLog">
        <h3>Event Log:</h3>
        <div id="events"></div>
    </div>
    
    <div 
        x-data="{ items: ['Item A', 'Item B', 'Item C', 'Item D'] }"
        x-drag-context="console.log('Drop event:', $event)"
        class="drag-container"
        id="dragContainer"
    >
        <h3>Test Drag and Drop Items</h3>
        <p>Try dragging items with mouse or keyboard to test for drag:end event</p>
        
        <template x-for="(item, index) in items" :key="item">
            <div 
                x-drag-item="{ id: index, text: item }"
                class="drag-item"
                x-text="item"
            ></div>
        </template>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const eventLog = document.getElementById('events');
            let eventCount = 0;
            
            function logEvent(eventName, details) {
                eventCount++;
                const entry = document.createElement('div');
                entry.className = 'event-entry';
                entry.innerHTML = `
                    <strong>${eventCount}. ${eventName}</strong><br>
                    <small>Time: ${new Date().toLocaleTimeString()}</small><br>
                    ${details}
                `;
                eventLog.appendChild(entry);
                eventLog.scrollTop = eventLog.scrollHeight;
            }
            
            // Listen for the drag:end event that should be implemented
            document.getElementById('dragContainer').addEventListener('drag:end', (event) => {
                logEvent('drag:end', `
                    Event Detail: ${JSON.stringify(event.detail, null, 2)}
                `);
            });
            
            // Listen for other drag-related events to compare
            document.getElementById('dragContainer').addEventListener('dragover', (event) => {
                // Don't log dragover as it fires too frequently
            });
            
            document.getElementById('dragContainer').addEventListener('drop', (event) => {
                logEvent('drop', `Standard HTML drop event fired`);
                
                // Check if drag:end event was also fired
                setTimeout(() => {
                    const lastEntry = eventLog.lastElementChild;
                    if (!lastEntry || !lastEntry.innerHTML.includes('drag:end')) {
                        const missingEntry = document.createElement('div');
                        missingEntry.className = 'event-entry event-missing';
                        missingEntry.innerHTML = `
                            <strong>‚ùå MISSING: drag:end event</strong><br>
                            <small>Expected after drop event</small><br>
                            The drag:end event should have been dispatched with payload: { group, oldIndex, newIndex, sourceElement, targetElement }
                        `;
                        eventLog.appendChild(missingEntry);
                        eventLog.scrollTop = eventLog.scrollHeight;
                    }
                }, 100);
            });
            
            // Initial message
            logEvent('Test Started', 'Waiting for drag and drop operations...');
        });
    </script>
</body>
</html>
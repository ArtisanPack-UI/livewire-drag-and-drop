<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixed Alpine Expression Syntax</title>
    <style>
        .drag-item {
            padding: 10px;
            margin: 5px 0;
            background: #f0f0f0;
            border: 1px solid #ccc;
            cursor: grab;
        }
        .drag-item:active {
            cursor: grabbing;
        }
        .is-dragging {
            opacity: 0.5;
        }
        .sr-only {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        .example {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        .example h3 {
            margin-top: 0;
            color: #333;
        }
        .broken {
            border-color: #f44336;
            background: #ffebee;
        }
        .fixed {
            border-color: #4caf50;
            background: #e8f5e8;
        }
    </style>
</head>
<body>
    <h1>Alpine.js Expression Syntax Fix for Drag and Drop</h1>
    
    <div class="example broken">
        <h3>❌ BROKEN: Original syntax that causes "Unexpected token '}'" error</h3>
        <p><strong>Problem:</strong> Invalid JavaScript syntax in x-data - cannot define function body inside object literal like this</p>
        <pre><code>x-data="{ handleDrop(event) { console.log(event); const { oldIndex, newIndex } = event.detail; if (oldIndex !== newIndex) { $wire.handleReorder({ oldIndex, newIndex }); } } }"</code></pre>
        
        <!-- This WOULD cause the error, commented out for safety -->
        <!--
        <div class="space-y-4" 
             x-data="{ handleDrop(event) { console.log(event); const { oldIndex, newIndex } = event.detail; if (oldIndex !== newIndex) { $wire.handleReorder({ oldIndex, newIndex }); } } }" 
             x-drag-context 
             @drag:end="handleDrop($event)">
            <div class="drag-item" x-drag-item="{id: 1, title: 'Item 1'}">Item 1</div>
        </div>
        -->
    </div>

    <div class="example fixed">
        <h3>✅ FIXED: Correct Alpine.js syntax - Method 1 (Arrow Function)</h3>
        <p><strong>Solution:</strong> Use arrow function syntax in the object literal</p>
        <pre><code>x-data="{ handleDrop: (event) => { console.log(event); const { oldIndex, newIndex } = event.detail; if (oldIndex !== newIndex) { $wire.handleReorder({ oldIndex, newIndex }); } } }"</code></pre>
        
        <div class="space-y-4" 
             x-data="{ handleDrop: (event) => { console.log(event); const { oldIndex, newIndex } = event.detail; if (oldIndex !== newIndex) { $wire.handleReorder({ oldIndex, newIndex }); } } }" 
             x-drag-context 
             @drag:end="handleDrop($event)" 
             role="application" 
             aria-label="Fixed drag and drop interface - Method 1">
            
            <div class="drag-item" x-drag-item="{id: 1, title: 'Item 1'}">Item 1 (Method 1)</div>
            <div class="drag-item" x-drag-item="{id: 2, title: 'Item 2'}">Item 2 (Method 1)</div>
            <div class="drag-item" x-drag-item="{id: 3, title: 'Item 3'}">Item 3 (Method 1)</div>
        </div>
    </div>

    <div class="example fixed">
        <h3>✅ FIXED: Correct Alpine.js syntax - Method 2 (Function Property)</h3>
        <p><strong>Solution:</strong> Use function property syntax</p>
        <pre><code>x-data="{ handleDrop: function(event) { console.log(event); const { oldIndex, newIndex } = event.detail; if (oldIndex !== newIndex) { $wire.handleReorder({ oldIndex, newIndex }); } } }"</code></pre>
        
        <div class="space-y-4" 
             x-data="{ handleDrop: function(event) { console.log(event); const { oldIndex, newIndex } = event.detail; if (oldIndex !== newIndex) { $wire.handleReorder({ oldIndex, newIndex }); } } }" 
             x-drag-context 
             @drag:end="handleDrop($event)" 
             role="application" 
             aria-label="Fixed drag and drop interface - Method 2">
            
            <div class="drag-item" x-drag-item="{id: 4, title: 'Item 4'}">Item 4 (Method 2)</div>
            <div class="drag-item" x-drag-item="{id: 5, title: 'Item 5'}">Item 5 (Method 2)</div>
            <div class="drag-item" x-drag-item="{id: 6, title: 'Item 6'}">Item 6 (Method 2)</div>
        </div>
    </div>

    <div class="example fixed">
        <h3>✅ FIXED: Best Practice - Inline Event Handler</h3>
        <p><strong>Recommended:</strong> For simple handlers, use inline approach without x-data method</p>
        <pre><code>x-data="{}" @drag:end="console.log($event); const { oldIndex, newIndex } = $event.detail; if (oldIndex !== newIndex) { $wire.handleReorder({ oldIndex, newIndex }); }"</code></pre>
        
        <div class="space-y-4" 
             x-data="{}" 
             x-drag-context 
             @drag:end="console.log($event); const { oldIndex, newIndex } = $event.detail; if (oldIndex !== newIndex) { $wire.handleReorder({ oldIndex, newIndex }); }" 
             role="application" 
             aria-label="Best practice drag and drop interface">
            
            <div class="drag-item" x-drag-item="{id: 7, title: 'Item 7'}">Item 7 (Best Practice)</div>
            <div class="drag-item" x-drag-item="{id: 8, title: 'Item 8'}">Item 8 (Best Practice)</div>
            <div class="drag-item" x-drag-item="{id: 9, title: 'Item 9'}">Item 9 (Best Practice)</div>
        </div>
    </div>

    <div id="success-log" style="margin-top: 20px; padding: 10px; background: #e8f5e8; border: 1px solid #4caf50;">
        <h3>Success Log:</h3>
        <div id="success-messages"></div>
    </div>

    <script type="module">
        // Mock $wire object for testing
        window.$wire = {
            handleReorder: function(data) {
                console.log('Mock $wire.handleReorder called with:', data);
                const successDiv = document.getElementById('success-messages');
                successDiv.innerHTML += `<p style="color: #4caf50; margin: 5px 0;">✅ $wire.handleReorder called successfully with oldIndex: ${data.oldIndex}, newIndex: ${data.newIndex}</p>`;
            }
        };

        import Alpine from './node_modules/alpinejs/dist/module.esm.js';
        import LivewireDragAndDrop from './src/index.js';

        try {
            LivewireDragAndDrop(Alpine);
            Alpine.start();
            console.log('Alpine and LivewireDragAndDrop initialized successfully');
            const successDiv = document.getElementById('success-messages');
            successDiv.innerHTML += `<p style="color: #4caf50; margin: 5px 0;">✅ Alpine and LivewireDragAndDrop initialized successfully</p>`;
        } catch (error) {
            console.error('Error initializing:', error);
        }
    </script>
</body>
</html>